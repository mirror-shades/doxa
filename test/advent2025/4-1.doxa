

entry function main() {
    const input is @read("./advent4.txt")
    const split_input is split(input, "\n")
    var accessable_paper :: int
    const rows is @length(split_input)
    const cols is @length(split_input[0])
    for i while i < rows do i += 1 {
        for j while j < cols do j += 1 {
            if split_input[i][j] == "@" then {
                var blocked :: int
                var up_free is true
                var down_free is true
                var left_free is true
                var right_free is true
                if j + 1 > cols then right_free is false
                if j - 1 < 0 then left_free is false
                if i + 1 > rows - 1 then down_free is false
                if i - 1 < 0 then up_free is false
                if up_free then {
                    if split_input[i -  1][j] == "@" then {
                        blocked += 1
                    }
                }
                if down_free then {
                    if split_input[i + 1][j] == "@" then {
                        blocked += 1
                    }
                }
                if left_free then {
                    if split_input[i][j - 1] == "@" then {
                        blocked += 1
                    }
                }
                if right_free then {
                    if split_input[i][j + 1] == "@" then {
                        blocked += 1
                    }
                }
                if right_free and up_free then {
                    if split_input[i - 1][j + 1] == "@" then {
                        blocked += 1
                    }
                }
                if right_free and down_free then {
                    if split_input[i + 1][j + 1] == "@" then {
                        blocked += 1
                    }
                }
                if left_free and up_free then {
                    if split_input[i - 1][j - 1] == "@" then {
                        blocked += 1
                    }
                }
                if left_free and down_free then {
                    if split_input[i + 1][j - 1] == "@" then {
                        blocked += 1
                    }
                }

                if blocked < 4 then {
                    accessable_paper += 1
                }
            }
        }
    }
    accessable_paper?
}

function split(input :: string, separator :: string) returns string[] {
    if @length(input) == 0 then return []
    
    var result :: string[]
    var start_idx is 0
    var i is 0
    
    while i < @length(input) do i += 1 {
        if input[i] == separator then {
            @push(result, @slice(input, start_idx, i - start_idx))
            start_idx is i + 1
        }
    }
    
    @push(result, @slice(input, start_idx, @length(input) - start_idx))
    return result
}