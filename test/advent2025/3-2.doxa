

entry function main() {
    const input is @read("./advent3.txt")
    const split_input is split(input, "\n")
    var total_power :: int
    each line in split_input {
        var highest_number :: int
        var highest_number_index :: int
        var number_strings :: string[]
        var indexes :: int[]
        var peak_power :: int
        var start_pos :: int
        for depth is 12 while depth > 0 do depth -= 1 {
            var c is start_pos
            while c <= @length(line) - depth {
                if @int(line[c]) > highest_number then {
                    highest_number is @int(line[c])
                    highest_number_index is c
                }
                c += 1
            }
            @push(number_strings, line[highest_number_index])
            @push(indexes, highest_number_index)
            start_pos is highest_number_index + 1
            highest_number is 0
        }
        var peak_power_string :: string
        each s in number_strings {
            peak_power_string += @string(s)
        }
        peak_power is @int(peak_power_string)
        total_power += peak_power
    }
    total_power?
}

function split(input :: string, separator :: string) returns string[] {
    if @length(input) == 0 then return []
    
    var result :: string[]
    var start_idx is 0
    var i is 0
    
    while i < @length(input) do i += 1 {
        if input[i] == separator then {
            @push(result, @slice(input, start_idx, i - start_idx))
            start_idx is i + 1
        }
    }
    
    @push(result, @slice(input, start_idx, @length(input) - start_idx))
    return result
}